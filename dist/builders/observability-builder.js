"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ObservabilityBuilder = void 0;
const stacks_1 = require("../stacks");
const addons = require("../addons");
const utils = require("../utils");
const utils_1 = require("../utils");
const aws_cdk_lib_1 = require("aws-cdk-lib");
class ObservabilityBuilder extends stacks_1.BlueprintBuilder {
    constructor() {
        super(...arguments);
        this.coreDnsVersion = "auto";
        this.kubeProxyVersion = "auto";
    }
    /**
     * This method helps you prepare a blueprint for setting up observability
     * returning an array of blueprint addons for AWS native services
     */
    enableNativePatternAddOns() {
        return this.addOns(new addons.AwsLoadBalancerControllerAddOn(this.awsLoadbalancerProps), new addons.CertManagerAddOn(this.certManagerProps), new addons.CloudWatchInsights(this.cloudWatchInsightsAddOnProps), new addons.CoreDnsAddOn(this.coreDnsVersion, this.coreDnsProps), new addons.KubeProxyAddOn(this.kubeProxyVersion, this.kubeProxyProps), new addons.KubeStateMetricsAddOn(this.kubeStateMetricsProps), new addons.MetricsServerAddOn(this.metricsServerProps), new addons.PrometheusNodeExporterAddOn(this.prometheusNodeExporterProps));
    }
    /**
     * This method helps you prepare a blueprint for setting up observability
     * returning an array of blueprint addons for AWS Fargate services
     */
    enableFargatePatternAddOns() {
        return this.addOns(new addons.AwsLoadBalancerControllerAddOn(this.awsLoadbalancerProps), new addons.CertManagerAddOn(this.certManagerProps), new addons.AdotCollectorAddOn(this.adotCollectorProps), new addons.CoreDnsAddOn(this.coreDnsVersion, this.coreDnsProps), new addons.KubeProxyAddOn(this.kubeProxyVersion, this.kubeProxyProps), new addons.KubeStateMetricsAddOn(this.kubeStateMetricsProps), new addons.MetricsServerAddOn(this.metricsServerProps));
    }
    /**
     * This method helps you prepare a blueprint for setting up observability
     * returning an array of blueprint addons for combination of AWS native and
     * AWS managed open source services
     */
    enableMixedPatternAddOns() {
        return this.addOns(new addons.AwsLoadBalancerControllerAddOn(this.awsLoadbalancerProps), new addons.CertManagerAddOn(this.certManagerProps), new addons.AdotCollectorAddOn(this.adotCollectorProps), new addons.CoreDnsAddOn(this.coreDnsVersion, this.coreDnsProps), new addons.KubeProxyAddOn(this.kubeProxyVersion, this.kubeProxyProps), new addons.KubeStateMetricsAddOn(this.kubeStateMetricsProps), new addons.MetricsServerAddOn(this.metricsServerProps), new addons.PrometheusNodeExporterAddOn(this.prometheusNodeExporterProps));
    }
    /**
     * This method helps you prepare a blueprint for setting up observability
     * returning an array of blueprint addons for AWS managed open source services
     */
    enableOpenSourcePatternAddOns() {
        return this.addOns(new addons.AwsLoadBalancerControllerAddOn(this.awsLoadbalancerProps), new addons.CertManagerAddOn(this.certManagerProps), new addons.AdotCollectorAddOn(this.adotCollectorProps), new addons.AmpAddOn(this.ampProps), new addons.CoreDnsAddOn(this.coreDnsVersion, this.coreDnsProps), new addons.ExternalsSecretsAddOn(this.externalSecretProps), new addons.GrafanaOperatorAddon(this.grafanaOperatorProps), new addons.KubeProxyAddOn(this.kubeProxyVersion, this.kubeProxyProps), new addons.KubeStateMetricsAddOn(this.kubeStateMetricsProps), new addons.MetricsServerAddOn(this.metricsServerProps), new addons.PrometheusNodeExporterAddOn(this.prometheusNodeExporterProps));
    }
    /**
     * Enables control plane logging.
     * Enabling control plane logging is an in-place change for EKS as inferred from
     * https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html
     *
     * @returns {ObservabilityBuilder} - The ObservabilityBuilder instance with control plane logging enabled.
     */
    enableControlPlaneLogging() {
        return this.enableControlPlaneLogTypes(stacks_1.ControlPlaneLogType.API, stacks_1.ControlPlaneLogType.AUDIT, stacks_1.ControlPlaneLogType.AUTHENTICATOR, stacks_1.ControlPlaneLogType.CONTROLLER_MANAGER, stacks_1.ControlPlaneLogType.SCHEDULER);
    }
    withAwsLoadBalancerControllerProps(props) {
        this.awsLoadbalancerProps = { ...this.awsLoadbalancerProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withCertManagerProps(props) {
        this.certManagerProps = { ...this.certManagerProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withCloudWatchInsightsProps(props) {
        this.cloudWatchInsightsAddOnProps = { ...this.cloudWatchInsightsAddOnProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withCoreDnsProps(props) {
        this.coreDnsProps = { ...this.coreDnsProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withKubeProxyProps(props, version) {
        this.kubeProxyProps = { ...this.kubeProxyProps, ...(0, utils_1.cloneDeep)(props) };
        this.kubeProxyVersion = version;
        return this;
    }
    withKubeStateMetricsProps(props) {
        this.kubeStateMetricsProps = { ...this.kubeStateMetricsProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withMetricsServerProps(props) {
        this.metricsServerProps = { ...this.metricsServerProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withPrometheusNodeExporterProps(props) {
        this.prometheusNodeExporterProps = { ...this.prometheusNodeExporterProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withAdotCollectorProps(props) {
        this.adotCollectorProps = { ...this.adotCollectorProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withExternalSecretsProps(props) {
        this.externalSecretProps = { ...this.externalSecretProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withGrafanaOperatorProps(props) {
        this.grafanaOperatorProps = { ...this.grafanaOperatorProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    withAmpProps(props) {
        this.ampProps = { ...this.ampProps, ...(0, utils_1.cloneDeep)(props) };
        return this;
    }
    /**
     * This method helps you prepare a blueprint for setting up observability with
     * usage tracking addon
     */
    static builder() {
        const builder = new ObservabilityBuilder();
        builder.addOns(new addons.NestedStackAddOn({
            id: "usage-tracking-addon",
            builder: UsageTrackingAddOn.builder(),
        }));
        return builder;
    }
}
exports.ObservabilityBuilder = ObservabilityBuilder;
/**
 * Nested stack that is used as tracker for Observability Accelerator
 */
class UsageTrackingAddOn extends aws_cdk_lib_1.NestedStack {
    static builder() {
        return {
            build(scope, id, props) {
                return new UsageTrackingAddOn(scope, id, props);
            }
        };
    }
    constructor(scope, id, props) {
        super(scope, id, utils.withUsageTracking(UsageTrackingAddOn.USAGE_ID, props));
    }
}
UsageTrackingAddOn.USAGE_ID = "qs-1u9l12gj7";
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JzZXJ2YWJpbGl0eS1idWlsZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vbGliL2J1aWxkZXJzL29ic2VydmFiaWxpdHktYnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxzQ0FBZ0U7QUFDaEUsb0NBQW9DO0FBQ3BDLGtDQUFrQztBQUNsQyxvQ0FBbUM7QUFFbkMsNkNBQTBEO0FBRzFELE1BQWEsb0JBQXFCLFNBQVEseUJBQWdCO0lBQTFEOztRQU1ZLG1CQUFjLEdBQVcsTUFBTSxDQUFDO1FBRWhDLHFCQUFnQixHQUFXLE1BQU0sQ0FBQztJQXNLOUMsQ0FBQztJQTdKRzs7O09BR0c7SUFDSSx5QkFBeUI7UUFDNUIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUNkLElBQUksTUFBTSxDQUFDLDhCQUE4QixDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxFQUNwRSxJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFDbEQsSUFBSSxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLEVBQ2hFLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFDOUQsSUFBSSxNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEVBQ3BFLElBQUksTUFBTSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxFQUM1RCxJQUFJLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsRUFDdEQsSUFBSSxNQUFNLENBQUMsMkJBQTJCLENBQUMsSUFBSSxDQUFDLDJCQUEyQixDQUFDLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksMEJBQTBCO1FBQzdCLE9BQU8sSUFBSSxD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VHlwZX0gZnJvbSAnLi4vc3RhY2tzJztcbmltcG9ydCAqIGFzIGFkZG9ucyBmcm9tICcuLi9hZGRvbnMnO1xuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSBcIi4uL3V0aWxzXCI7XG5pbXBvcnQge2Nsb25lRGVlcH0gZnJvbSBcIi4uL3V0aWxzXCI7XG5pbXBvcnQgKiBhcyBzcGkgZnJvbSAnLi4vc3BpJztcbmltcG9ydCB7TmVzdGVkU3RhY2ssIE5lc3RlZFN0YWNrUHJvcHN9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7Q29uc3RydWN0fSBmcm9tICdjb25zdHJ1Y3RzJztcblxuZXhwb3J0IGNsYXNzIE9ic2VydmFiaWxpdHlCdWlsZGVyIGV4dGVuZHMgQmx1ZXByaW50QnVpbGRlciB7XG5cbiAgICBwcml2YXRlIGF3c0xvYWRiYWxhbmNlclByb3BzOiBhZGRvbnMuQXdzTG9hZEJhbGFuY2VyQ29udHJvbGxlclByb3BzO1xuICAgIHByaXZhdGUgY2VydE1hbmFnZXJQcm9wczogYWRkb25zLkNlcnRNYW5hZ2VyQWRkT25Qcm9wcztcbiAgICBwcml2YXRlIGNsb3VkV2F0Y2hJbnNpZ2h0c0FkZE9uUHJvcHM6IGFkZG9ucy5DbG91ZFdhdGNoSW5zaWdodHNBZGRPblByb3BzO1xuICAgIHByaXZhdGUgY29yZURuc1Byb3BzOiBhZGRvbnMuQ29yZURuc0FkZE9uUHJvcHM7XG4gICAgcHJpdmF0ZSBjb3JlRG5zVmVyc2lvbjogc3RyaW5nID0gXCJhdXRvXCI7XG4gICAgcHJpdmF0ZSBrdWJlUHJveHlQcm9wczogYWRkb25zLmt1YmVQcm94eUFkZE9uUHJvcHM7XG4gICAgcHJpdmF0ZSBrdWJlUHJveHlWZXJzaW9uOiBzdHJpbmcgPSBcImF1dG9cIjtcbiAgICBwcml2YXRlIGt1YmVTdGF0ZU1ldHJpY3NQcm9wczogYWRkb25zLkt1YmVTdGF0ZU1ldHJpY3NBZGRPblByb3BzO1xuICAgIHByaXZhdGUgbWV0cmljc1NlcnZlclByb3BzOiBhZGRvbnMuTWV0cmljc1NlcnZlckFkZE9uUHJvcHM7XG4gICAgcHJpdmF0ZSBwcm9tZXRoZXVzTm9kZUV4cG9ydGVyUHJvcHM6IGFkZG9ucy5Qcm9tZXRoZXVzTm9kZUV4cG9ydGVyQWRkT25Qcm9wcztcbiAgICBwcml2YXRlIGFkb3RDb2xsZWN0b3JQcm9wczogYWRkb25zLkFkb3RDb2xsZWN0b3JBZGRPblByb3BzO1xuICAgIHByaXZhdGUgZXh0ZXJuYWxTZWNyZXRQcm9wczogYWRkb25zLkV4dGVybmFsc1NlY3JldHNBZGRPblByb3BzO1xuICAgIHByaXZhdGUgZ3JhZmFuYU9wZXJhdG9yUHJvcHM6IGFkZG9ucy5HcmFmYW5hT3BlcmF0b3JBZGRvblByb3BzO1xuICAgIHByaXZhdGUgYW1wUHJvcHM6IGFkZG9ucy5BbXBBZGRPblByb3BzO1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaGVscHMgeW91IHByZXBhcmUgYSBibHVlcHJpbnQgZm9yIHNldHRpbmcgdXAgb2JzZXJ2YWJpbGl0eSBcbiAgICAgKiByZXR1cm5pbmcgYW4gYXJyYXkgb2YgYmx1ZXByaW50IGFkZG9ucyBmb3IgQVdTIG5hdGl2ZSBzZXJ2aWNlc1xuICAgICAqL1xuICAgIHB1YmxpYyBlbmFibGVOYXRpdmVQYXR0ZXJuQWRkT25zKCk6IE9ic2VydmFiaWxpdHlCdWlsZGVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkT25zKFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5Bd3NMb2FkQmFsYW5jZXJDb250cm9sbGVyQWRkT24odGhpcy5hd3NMb2FkYmFsYW5jZXJQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkNlcnRNYW5hZ2VyQWRkT24odGhpcy5jZXJ0TWFuYWdlclByb3BzKSxcbiAgICAgICAgICAgIG5ldyBhZGRvbnMuQ2xvdWRXYXRjaEluc2lnaHRzKHRoaXMuY2xvdWRXYXRjaEluc2lnaHRzQWRkT25Qcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkNvcmVEbnNBZGRPbih0aGlzLmNvcmVEbnNWZXJzaW9uLHRoaXMuY29yZURuc1Byb3BzKSxcbiAgICAgICAgICAgIG5ldyBhZGRvbnMuS3ViZVByb3h5QWRkT24odGhpcy5rdWJlUHJveHlWZXJzaW9uLHRoaXMua3ViZVByb3h5UHJvcHMpLFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5LdWJlU3RhdGVNZXRyaWNzQWRkT24odGhpcy5rdWJlU3RhdGVNZXRyaWNzUHJvcHMpLFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5NZXRyaWNzU2VydmVyQWRkT24odGhpcy5tZXRyaWNzU2VydmVyUHJvcHMpLFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5Qcm9tZXRoZXVzTm9kZUV4cG9ydGVyQWRkT24odGhpcy5wcm9tZXRoZXVzTm9kZUV4cG9ydGVyUHJvcHMpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaGVscHMgeW91IHByZXBhcmUgYSBibHVlcHJpbnQgZm9yIHNldHRpbmcgdXAgb2JzZXJ2YWJpbGl0eSBcbiAgICAgKiByZXR1cm5pbmcgYW4gYXJyYXkgb2YgYmx1ZXByaW50IGFkZG9ucyBmb3IgQVdTIEZhcmdhdGUgc2VydmljZXNcbiAgICAgKi9cbiAgICBwdWJsaWMgZW5hYmxlRmFyZ2F0ZVBhdHRlcm5BZGRPbnMoKTogT2JzZXJ2YWJpbGl0eUJ1aWxkZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGRPbnMoXG4gICAgICAgICAgICBuZXcgYWRkb25zLkF3c0xvYWRCYWxhbmNlckNvbnRyb2xsZXJBZGRPbih0aGlzLmF3c0xvYWRiYWxhbmNlclByb3BzKSxcbiAgICAgICAgICAgIG5ldyBhZGRvbnMuQ2VydE1hbmFnZXJBZGRPbih0aGlzLmNlcnRNYW5hZ2VyUHJvcHMpLFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5BZG90Q29sbGVjdG9yQWRkT24odGhpcy5hZG90Q29sbGVjdG9yUHJvcHMpLFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5Db3JlRG5zQWRkT24odGhpcy5jb3JlRG5zVmVyc2lvbix0aGlzLmNvcmVEbnNQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkt1YmVQcm94eUFkZE9uKHRoaXMua3ViZVByb3h5VmVyc2lvbiwgdGhpcy5rdWJlUHJveHlQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkt1YmVTdGF0ZU1ldHJpY3NBZGRPbih0aGlzLmt1YmVTdGF0ZU1ldHJpY3NQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLk1ldHJpY3NTZXJ2ZXJBZGRPbih0aGlzLm1ldHJpY3NTZXJ2ZXJQcm9wcykpO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBoZWxwcyB5b3UgcHJlcGFyZSBhIGJsdWVwcmludCBmb3Igc2V0dGluZyB1cCBvYnNlcnZhYmlsaXR5IFxuICAgICAqIHJldHVybmluZyBhbiBhcnJheSBvZiBibHVlcHJpbnQgYWRkb25zIGZvciBjb21iaW5hdGlvbiBvZiBBV1MgbmF0aXZlIGFuZCBcbiAgICAgKiBBV1MgbWFuYWdlZCBvcGVuIHNvdXJjZSBzZXJ2aWNlc1xuICAgICAqL1xuICAgIHB1YmxpYyBlbmFibGVNaXhlZFBhdHRlcm5BZGRPbnMoKTogT2JzZXJ2YWJpbGl0eUJ1aWxkZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGRPbnMoXG4gICAgICAgICAgICBuZXcgYWRkb25zLkF3c0xvYWRCYWxhbmNlckNvbnRyb2xsZXJBZGRPbih0aGlzLmF3c0xvYWRiYWxhbmNlclByb3BzKSxcbiAgICAgICAgICAgIG5ldyBhZGRvbnMuQ2VydE1hbmFnZXJBZGRPbih0aGlzLmNlcnRNYW5hZ2VyUHJvcHMpLFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5BZG90Q29sbGVjdG9yQWRkT24odGhpcy5hZG90Q29sbGVjdG9yUHJvcHMpLFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5Db3JlRG5zQWRkT24odGhpcy5jb3JlRG5zVmVyc2lvbix0aGlzLmNvcmVEbnNQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkt1YmVQcm94eUFkZE9uKHRoaXMua3ViZVByb3h5VmVyc2lvbiwgdGhpcy5rdWJlUHJveHlQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkt1YmVTdGF0ZU1ldHJpY3NBZGRPbih0aGlzLmt1YmVTdGF0ZU1ldHJpY3NQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLk1ldHJpY3NTZXJ2ZXJBZGRPbih0aGlzLm1ldHJpY3NTZXJ2ZXJQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLlByb21ldGhldXNOb2RlRXhwb3J0ZXJBZGRPbih0aGlzLnByb21ldGhldXNOb2RlRXhwb3J0ZXJQcm9wcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgbWV0aG9kIGhlbHBzIHlvdSBwcmVwYXJlIGEgYmx1ZXByaW50IGZvciBzZXR0aW5nIHVwIG9ic2VydmFiaWxpdHkgXG4gICAgICogcmV0dXJuaW5nIGFuIGFycmF5IG9mIGJsdWVwcmludCBhZGRvbnMgZm9yIEFXUyBtYW5hZ2VkIG9wZW4gc291cmNlIHNlcnZpY2VzXG4gICAgICovXG4gICAgcHVibGljIGVuYWJsZU9wZW5Tb3VyY2VQYXR0ZXJuQWRkT25zKCk6IE9ic2VydmFiaWxpdHlCdWlsZGVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkT25zKFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5Bd3NMb2FkQmFsYW5jZXJDb250cm9sbGVyQWRkT24odGhpcy5hd3NMb2FkYmFsYW5jZXJQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkNlcnRNYW5hZ2VyQWRkT24odGhpcy5jZXJ0TWFuYWdlclByb3BzKSxcbiAgICAgICAgICAgIG5ldyBhZGRvbnMuQWRvdENvbGxlY3RvckFkZE9uKHRoaXMuYWRvdENvbGxlY3RvclByb3BzKSxcbiAgICAgICAgICAgIG5ldyBhZGRvbnMuQW1wQWRkT24odGhpcy5hbXBQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkNvcmVEbnNBZGRPbih0aGlzLmNvcmVEbnNWZXJzaW9uLHRoaXMuY29yZURuc1Byb3BzKSxcbiAgICAgICAgICAgIG5ldyBhZGRvbnMuRXh0ZXJuYWxzU2VjcmV0c0FkZE9uKHRoaXMuZXh0ZXJuYWxTZWNyZXRQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkdyYWZhbmFPcGVyYXRvckFkZG9uKHRoaXMuZ3JhZmFuYU9wZXJhdG9yUHJvcHMpLFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5LdWJlUHJveHlBZGRPbih0aGlzLmt1YmVQcm94eVZlcnNpb24sdGhpcy5rdWJlUHJveHlQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLkt1YmVTdGF0ZU1ldHJpY3NBZGRPbih0aGlzLmt1YmVTdGF0ZU1ldHJpY3NQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLk1ldHJpY3NTZXJ2ZXJBZGRPbih0aGlzLm1ldHJpY3NTZXJ2ZXJQcm9wcyksXG4gICAgICAgICAgICBuZXcgYWRkb25zLlByb21ldGhldXNOb2RlRXhwb3J0ZXJBZGRPbih0aGlzLnByb21ldGhldXNOb2RlRXhwb3J0ZXJQcm9wcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuYWJsZXMgY29udHJvbCBwbGFuZSBsb2dnaW5nLlxuICAgICAqIEVuYWJsaW5nIGNvbnRyb2wgcGxhbmUgbG9nZ2luZyBpcyBhbiBpbi1wbGFjZSBjaGFuZ2UgZm9yIEVLUyBhcyBpbmZlcnJlZCBmcm9tXG4gICAgICogaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2Vrcy9sYXRlc3QvdXNlcmd1aWRlL2NvbnRyb2wtcGxhbmUtbG9ncy5odG1sXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJpbGl0eUJ1aWxkZXJ9IC0gVGhlIE9ic2VydmFiaWxpdHlCdWlsZGVyIGluc3RhbmNlIHdpdGggY29udHJvbCBwbGFuZSBsb2dnaW5nIGVuYWJsZWQuXG4gICAgICovXG4gICAgcHVibGljIGVuYWJsZUNvbnRyb2xQbGFuZUxvZ2dpbmcoKTogT2JzZXJ2YWJpbGl0eUJ1aWxkZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5lbmFibGVDb250cm9sUGxhbmVMb2dUeXBlcyhcbiAgICAgICAgICBDb250cm9sUGxhbmVMb2dUeXBlLkFQSSxcbiAgICAgICAgICBDb250cm9sUGxhbmVMb2dUeXBlLkFVRElULFxuICAgICAgICAgIENvbnRyb2xQbGFuZUxvZ1R5cGUuQVVUSEVOVElDQVRPUixcbiAgICAgICAgICBDb250cm9sUGxhbmVMb2dUeXBlLkNPTlRST0xMRVJfTUFOQUdFUixcbiAgICAgICAgICBDb250cm9sUGxhbmVMb2dUeXBlLlNDSEVEVUxFUlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyB3aXRoQXdzTG9hZEJhbGFuY2VyQ29udHJvbGxlclByb3BzKHByb3BzOiBhZGRvbnMuQXdzTG9hZEJhbGFuY2VyQ29udHJvbGxlclByb3BzKSA6IHRoaXMge1xuICAgICAgICB0aGlzLmF3c0xvYWRiYWxhbmNlclByb3BzID0geyAuLi50aGlzLmF3c0xvYWRiYWxhbmNlclByb3BzLCAuLi5jbG9uZURlZXAocHJvcHMpIH07XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBcbiAgICBwdWJsaWMgd2l0aENlcnRNYW5hZ2VyUHJvcHMocHJvcHM6IGFkZG9ucy5DZXJ0TWFuYWdlckFkZE9uUHJvcHMpIDogdGhpcyB7XG4gICAgICAgIHRoaXMuY2VydE1hbmFnZXJQcm9wcyA9IHsgLi4udGhpcy5jZXJ0TWFuYWdlclByb3BzLCAuLi5jbG9uZURlZXAocHJvcHMpIH07XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHB1YmxpYyB3aXRoQ2xvdWRXYXRjaEluc2lnaHRzUHJvcHMocHJvcHM6IGFkZG9ucy5DbG91ZFdhdGNoSW5zaWdodHNBZGRPblByb3BzKSA6IHRoaXMge1xuICAgICAgICB0aGlzLmNsb3VkV2F0Y2hJbnNpZ2h0c0FkZE9uUHJvcHMgPSB7IC4uLnRoaXMuY2xvdWRXYXRjaEluc2lnaHRzQWRkT25Qcm9wcywgLi4uY2xvbmVEZWVwKHByb3BzKSB9O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBwdWJsaWMgd2l0aENvcmVEbnNQcm9wcyhwcm9wczphZGRvbnMuQ29yZURuc0FkZE9uUHJvcHMpIDogdGhpcyB7XG4gICAgICAgIHRoaXMuY29yZURuc1Byb3BzID0geyAuLi50aGlzLmNvcmVEbnNQcm9wcywgLi4uY2xvbmVEZWVwKHByb3BzKSB9O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBwdWJsaWMgd2l0aEt1YmVQcm94eVByb3BzKHByb3BzOmFkZG9ucy5rdWJlUHJveHlBZGRPblByb3BzLCB2ZXJzaW9uOiBzdHJpbmcpIDogdGhpcyB7XG4gICAgICAgIHRoaXMua3ViZVByb3h5UHJvcHMgPSB7IC4uLnRoaXMua3ViZVByb3h5UHJvcHMsIC4uLmNsb25lRGVlcChwcm9wcykgfTtcbiAgICAgICAgdGhpcy5rdWJlUHJveHlWZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHVibGljIHdpdGhLdWJlU3RhdGVNZXRyaWNzUHJvcHMocHJvcHM6YWRkb25zLkt1YmVTdGF0ZU1ldHJpY3NBZGRPblByb3BzKSA6IHRoaXMge1xuICAgICAgICB0aGlzLmt1YmVTdGF0ZU1ldHJpY3NQcm9wcyA9IHsgLi4udGhpcy5rdWJlU3RhdGVNZXRyaWNzUHJvcHMsIC4uLmNsb25lRGVlcChwcm9wcykgfTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHVibGljIHdpdGhNZXRyaWNzU2VydmVyUHJvcHMocHJvcHM6YWRkb25zLk1ldHJpY3NTZXJ2ZXJBZGRPblByb3BzKSA6IHRoaXMge1xuICAgICAgICB0aGlzLm1ldHJpY3NTZXJ2ZXJQcm9wcyA9IHsgLi4udGhpcy5tZXRyaWNzU2VydmVyUHJvcHMsIC4uLmNsb25lRGVlcChwcm9wcykgfTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHVibGljIHdpdGhQcm9tZXRoZXVzTm9kZUV4cG9ydGVyUHJvcHMocHJvcHM6YWRkb25zLlByb21ldGhldXNOb2RlRXhwb3J0ZXJBZGRPblByb3BzKSA6IHRoaXMge1xuICAgICAgICB0aGlzLnByb21ldGhldXNOb2RlRXhwb3J0ZXJQcm9wcyA9IHsgLi4udGhpcy5wcm9tZXRoZXVzTm9kZUV4cG9ydGVyUHJvcHMsIC4uLmNsb25lRGVlcChwcm9wcykgfTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHVibGljIHdpdGhBZG90Q29sbGVjdG9yUHJvcHMocHJvcHM6YWRkb25zLkFkb3RDb2xsZWN0b3JBZGRPblByb3BzKSA6IHRoaXMge1xuICAgICAgICB0aGlzLmFkb3RDb2xsZWN0b3JQcm9wcyA9IHsgLi4udGhpcy5hZG90Q29sbGVjdG9yUHJvcHMsIC4uLmNsb25lRGVlcChwcm9wcykgfTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHVibGljIHdpdGhFeHRlcm5hbFNlY3JldHNQcm9wcyhwcm9wczphZGRvbnMuRXh0ZXJuYWxEbnNQcm9wcykgOiB0aGlzIHtcbiAgICAgICAgdGhpcy5leHRlcm5hbFNlY3JldFByb3BzID0geyAuLi50aGlzLmV4dGVybmFsU2VjcmV0UHJvcHMsIC4uLmNsb25lRGVlcChwcm9wcykgfTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHVibGljIHdpdGhHcmFmYW5hT3BlcmF0b3JQcm9wcyhwcm9wczphZGRvbnMuR3JhZmFuYU9wZXJhdG9yQWRkb25Qcm9wcykgOiB0aGlzIHtcbiAgICAgICAgdGhpcy5ncmFmYW5hT3BlcmF0b3JQcm9wcyA9IHsgLi4udGhpcy5ncmFmYW5hT3BlcmF0b3JQcm9wcywgLi4uY2xvbmVEZWVwKHByb3BzKSB9O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgcHVibGljIHdpdGhBbXBQcm9wcyhwcm9wczphZGRvbnMuQW1wQWRkT25Qcm9wcykgOiB0aGlzIHtcbiAgICAgICAgdGhpcy5hbXBQcm9wcyA9IHsgLi4udGhpcy5hbXBQcm9wcywgLi4uY2xvbmVEZWVwKHByb3BzKSB9O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBoZWxwcyB5b3UgcHJlcGFyZSBhIGJsdWVwcmludCBmb3Igc2V0dGluZyB1cCBvYnNlcnZhYmlsaXR5IHdpdGggXG4gICAgICogdXNhZ2UgdHJhY2tpbmcgYWRkb25cbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGJ1aWxkZXIoKTogT2JzZXJ2YWJpbGl0eUJ1aWxkZXIge1xuICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IE9ic2VydmFiaWxpdHlCdWlsZGVyKCk7XG4gICAgICAgIGJ1aWxkZXIuYWRkT25zKFxuICAgICAgICAgICAgbmV3IGFkZG9ucy5OZXN0ZWRTdGFja0FkZE9uKHtcbiAgICAgICAgICAgICAgICBpZDogXCJ1c2FnZS10cmFja2luZy1hZGRvblwiLFxuICAgICAgICAgICAgICAgIGJ1aWxkZXI6IFVzYWdlVHJhY2tpbmdBZGRPbi5idWlsZGVyKCksXG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gYnVpbGRlcjtcbiAgICB9XG59XG5cbi8qKlxuICogTmVzdGVkIHN0YWNrIHRoYXQgaXMgdXNlZCBhcyB0cmFja2VyIGZvciBPYnNlcnZhYmlsaXR5IEFjY2VsZXJhdG9yXG4gKi9cbmNsYXNzIFVzYWdlVHJhY2tpbmdBZGRPbiBleHRlbmRzIE5lc3RlZFN0YWNrIHtcblxuICAgIHN0YXRpYyByZWFkb25seSBVU0FHRV9JRCA9IFwicXMtMXU5bDEyZ2o3XCI7XG5cbiAgICBwdWJsaWMgc3RhdGljIGJ1aWxkZXIoKTogc3BpLk5lc3RlZFN0YWNrQnVpbGRlciB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBidWlsZChzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogTmVzdGVkU3RhY2tQcm9wcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVXNhZ2VUcmFja2luZ0FkZE9uKHNjb3BlLCBpZCwgcHJvcHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBOZXN0ZWRTdGFja1Byb3BzKSB7XG4gICAgICAgIHN1cGVyKHNjb3BlLCBpZCwgdXRpbHMud2l0aFVzYWdlVHJhY2tpbmcoVXNhZ2VUcmFja2luZ0FkZE9uLlVTQUdFX0lELCBwcm9wcykpO1xuICAgIH1cbn0iXX0=